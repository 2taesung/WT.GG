<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.web.webtoon.model.dao.WebtoonDao">
	<select id="getRankingList" resultType="Webtoon">
		select w.platform_id,
		w.title, w.link, w.image_link, w.genre, w.story, w.artist, w.score, w.id
		from webtoon w
		order by w.score desc;
	</select>
	
	<select id="getWebtoonDetail" parameterType="int" resultType="Webtoon">
		select *
		from webtoon
		where id=#{id};
	</select>
	
	<select id="getTestResult" parameterType="Map" resultType="Webtoon">
		
		select id, drawing_style, humor, romance_ratio, genre as genre_score, deployment_speed, material_novelty, webtoon_id,
			(drawing_style - #{drawing_style} + humor - #{humor} + romance_ratio - #{romance_ratio} 
			+ genre - #{genre} + deployment_speed - #{deployment_speed} + material_novelty - #{material_novelty}) as total,
			<![CDATA[
			(case
				when (drawing_style - #{drawing_style} + humor - #{humor} + romance_ratio - #{romance_ratio} 
			+ genre - #{genre} + deployment_speed - #{deployment_speed} + material_novelty - #{material_novelty}) < 0
			    then (drawing_style - #{drawing_style} + humor - #{humor} + romance_ratio - #{romance_ratio} 
			+ genre - #{genre} + deployment_speed - #{deployment_speed} + material_novelty - #{material_novelty}) * -1
			    else (drawing_style - #{drawing_style} + humor - #{humor} + romance_ratio - #{romance_ratio} 
			+ genre - #{genre} + deployment_speed - #{deployment_speed} + material_novelty - #{material_novelty})
			end) as score
			]]>
		from characteristic
		order by score asc
		limit 1;
	</select>
</mapper>